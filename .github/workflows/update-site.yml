name: FastestLOL True Static-First Auto Update

on:
  # 1æ—¥4å›ã®è‡ªå‹•å®Ÿè¡Œï¼ˆJST: 6:00, 12:00, 18:00, 24:00ï¼‰
  # ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æƒ…å ±ã®æ–°é®®ã•ã‚’ä¿ã¤ãŸã‚ã®æœ€é©ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
  schedule:
    - cron: '0 21 * * *'  # JST 06:00 (UTC 21:00) - æœã®æ›´æ–°
    - cron: '0 3 * * *'   # JST 12:00 (UTC 03:00) - æ˜¼ã®æ›´æ–°  
    - cron: '0 9 * * *'   # JST 18:00 (UTC 09:00) - å¤•ã®æ›´æ–°
    - cron: '0 15 * * *'  # JST 24:00 (UTC 15:00) - æ·±å¤œæ›´æ–°
  
  # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½
  workflow_dispatch:
    inputs:
      build_type:
        description: 'Build type (dev/prod)'
        required: true
        default: 'prod'
        type: choice
        options:
        - prod
        - dev
      force_rebuild:
        description: 'Force complete rebuild (ignore cache)'
        required: false
        default: false
        type: boolean

env:
  # ã‚°ãƒ­ãƒ¼ãƒãƒ«ç’°å¢ƒå¤‰æ•°
  NODE_VERSION: '18'
  TARGET_REGION: 'jp1'
  ACCOUNT_REGION: 'asia'
  OUTPUT_DIR: '.'
  CACHE_DIR: './data'
  
jobs:
  # Job 1: True Static-Firstãƒ“ãƒ«ãƒ‰
  build-counter-data:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    outputs:
      pages-generated: ${{ steps.build-stats.outputs.pages }}
      listing-pages: ${{ steps.build-stats.outputs.listing-pages }}
      detail-pages: ${{ steps.build-stats.outputs.detail-pages }}
      data-quality: ${{ steps.build-stats.outputs.quality }}
      build-success: ${{ steps.build-stats.outputs.success }}
      index-size: ${{ steps.build-stats.outputs.index-size }}
      champion-images: ${{ steps.build-stats.outputs.champion-images }}
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: ${{ env.NODE_VERSION }}
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Verify API key configuration
      run: |
        if [ -z "${{ secrets.RIOT_API_KEY }}" ]; then
          echo "âŒ RIOT_API_KEY secret is not configured"
          exit 1
        fi
        echo "âœ… API key configured"
    
    - name: Restore build cache
      if: ${{ !inputs.force_rebuild }}
      uses: actions/cache@v3
      with:
        path: |
          data/cache.json
          images/champion
          images/item
          images/summoner
        key: fastest-lol-v2-${{ hashFiles('data/cache.json') }}-${{ hashFiles('package-lock.json') }}
        restore-keys: |
          fastest-lol-v2-${{ hashFiles('data/cache.json') }}-
          fastest-lol-v2-
    
    - name: Run API key verification
      env:
        RIOT_API_KEY: ${{ secrets.RIOT_API_KEY }}
        TARGET_REGION: ${{ env.TARGET_REGION }}
        ACCOUNT_REGION: ${{ env.ACCOUNT_REGION }}
      run: |
        npm run verify-api-key || {
          echo "âŒ API key verification failed"
          exit 1
        }
    
    - name: Clean previous build
      run: npm run clean
    
    - name: Build True Static-First Site
      env:
        RIOT_API_KEY: ${{ secrets.RIOT_API_KEY }}
        TARGET_REGION: ${{ env.TARGET_REGION }}
        ACCOUNT_REGION: ${{ env.ACCOUNT_REGION }}
        OUTPUT_DIR: ${{ env.OUTPUT_DIR }}
        CACHE_DIR: ${{ env.CACHE_DIR }}
        DEBUG_MODE: false
        VERBOSE_LOGGING: true
      run: |
        echo "ğŸš€ Starting True Static-First build..."
        
        # æœ¬ç•ªãƒ“ãƒ«ãƒ‰å®Ÿè¡Œï¼ˆå®Œå…¨ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æƒ…å ±ç”Ÿæˆï¼‰
        if [ "${{ inputs.build_type }}" == "dev" ]; then
          npm run build:dev
        else
          npm run build:prod
        fi
        
        echo "âœ… Build completed successfully!"
    
    - name: Validate True Static-First Architecture
      id: build-stats
      run: |
        echo "ğŸ” Validating True Static-First architecture..."
        
        # å¿…é ˆãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
        REQUIRED_FILES=("index.html" "sw.js" "manifest.json")
        for file in "${REQUIRED_FILES[@]}"; do
          if [ ! -f "$file" ]; then
            echo "âŒ Critical file missing: $file"
            exit 1
          fi
        done
        
        # ç”Ÿæˆãƒšãƒ¼ã‚¸æ•°ã‚«ã‚¦ãƒ³ãƒˆ
        LISTING_PAGES=$(find . -maxdepth 1 -name "*.html" | wc -l)
        DETAIL_PAGES=$(find . -name "*.html" | grep -v "^\\./[^/]*\\.html$" | wc -l || echo 0)
        TOTAL_PAGES=$((LISTING_PAGES + DETAIL_PAGES))
        
        echo "pages=$TOTAL_PAGES" >> $GITHUB_OUTPUT
        echo "listing-pages=$LISTING_PAGES" >> $GITHUB_OUTPUT
        echo "detail-pages=$DETAIL_PAGES" >> $GITHUB_OUTPUT
        
        # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹
        INDEX_SIZE=$(wc -c < index.html)
        echo "index-size=$INDEX_SIZE" >> $GITHUB_OUTPUT
        
        # Service Workeræ¤œè¨¼
        SW_SIZE=$(wc -c < sw.js)
        CACHED_FILES=$(grep -o '"[^"]*\\.html"' sw.js | wc -l || echo 0)
        echo "sw-size=$SW_SIZE" >> $GITHUB_OUTPUT
        echo "cached-files=$CACHED_FILES" >> $GITHUB_OUTPUT
        
        # ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³ç”»åƒæ•°
        CHAMPION_IMAGES=$(find images/champion -name "*.jpg" 2>/dev/null | wc -l || echo 0)
        echo "champion-images=$CHAMPION_IMAGES" >> $GITHUB_OUTPUT
        
        # ãƒ‡ãƒ¼ã‚¿å“è³ªè©•ä¾¡
        if [ $TOTAL_PAGES -ge 150 ] && [ $INDEX_SIZE -lt 300000 ] && [ $CHAMPION_IMAGES -ge 100 ]; then
          echo "quality=high" >> $GITHUB_OUTPUT
          echo "success=true" >> $GITHUB_OUTPUT
        elif [ $TOTAL_PAGES -ge 50 ] && [ $INDEX_SIZE -lt 500000 ]; then
          echo "quality=medium" >> $GITHUB_OUTPUT
          echo "success=true" >> $GITHUB_OUTPUT
        else
          echo "quality=low" >> $GITHUB_OUTPUT
          echo "success=false" >> $GITHUB_OUTPUT
        fi
        
        # çµæœã‚µãƒãƒªè¡¨ç¤º
        echo "ğŸ“Š True Static-First Build Statistics:"
        echo "  ğŸ“„ Total Pages Generated: $TOTAL_PAGES"
        echo "    â€¢ Listing Pages: $LISTING_PAGES"
        echo "    â€¢ Detail Pages: $DETAIL_PAGES"
        echo "  ğŸ’¾ Index.html Size: $INDEX_SIZE bytes"
        echo "  âš™ï¸ Service Worker: $SW_SIZE bytes ($CACHED_FILES files cached)"
        echo "  ğŸ–¼ï¸ Champion Images: $CHAMPION_IMAGES downloaded"
        echo "  âœ… Architecture: True Static-First"
        echo "  ğŸš€ Performance: Cache-First + Zero-JS + Zero-CSS"
    
    - name: Save build cache
      if: steps.build-stats.outputs.success == 'true'
      uses: actions/cache@v3
      with:
        path: |
          data/cache.json
          images/champion
          images/item
          images/summoner
        key: fastest-lol-v2-${{ hashFiles('data/cache.json') }}-${{ hashFiles('package-lock.json') }}

  # Job 2: ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ
  deploy-to-pages:
    runs-on: ubuntu-latest
    needs: build-counter-data
    if: needs.build-counter-data.outputs.build-success == 'true' && github.ref == 'refs/heads/main'
    permissions:
      pages: write
      id-token: write
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: ${{ env.NODE_VERSION }}
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: ğŸ” Debug Phase 1 - Initial state after checkout
      run: |
        echo "=============================================="
        echo "ğŸ” DEBUG: Initial state after checkout"
        echo "=============================================="
        echo "ğŸ“‚ Current working directory:"
        pwd
        echo ""
        echo "ğŸ“‚ Directory contents (detailed):"
        ls -la
        echo ""
        echo "ğŸ“‚ Root files only:"
        ls -1 *.* 2>/dev/null || echo "No root files found"
        echo ""
        echo "ğŸ”€ Git repository status:"
        git status || echo "âŒ Git command failed"
        echo ""
        echo "ğŸ“ .git directory check:"
        if [ -d ".git" ]; then
          echo "âœ… .git directory exists"
          ls -la .git/ | head -10
        else
          echo "âŒ .git directory missing"
        fi
        echo ""
        echo "ğŸŒ¿ Git branch info:"
        git branch -a 2>/dev/null || echo "âŒ Git branch command failed"
        echo ""
        echo "ğŸ“Š Disk usage:"
        du -sh * .* 2>/dev/null || true
        echo "=============================================="
    
    - name: Restore build cache
      uses: actions/cache@v3
      with:
        path: |
          data/cache.json
          images/champion
          images/item
          images/summoner
        key: fastest-lol-v2-${{ hashFiles('data/cache.json') }}-${{ hashFiles('package-lock.json') }}
        restore-keys: |
          fastest-lol-v2-
    
    - name: ğŸ” Debug Phase 2 - State after cache restore
      run: |
        echo "=============================================="
        echo "ğŸ” DEBUG: State after cache restore"
        echo "=============================================="
        echo "ğŸ“‚ Directory contents after cache:"
        ls -la
        echo ""
        echo "ğŸ“ Cache directories check:"
        echo "data/ contents:"
        ls -la data/ 2>/dev/null || echo "data/ directory not found"
        echo ""
        echo "images/ contents:"
        ls -la images/ 2>/dev/null || echo "images/ directory not found"
        echo ""
        echo "ğŸ”€ Git status after cache restore:"
        git status || echo "âŒ Git command failed after cache"
        echo ""
        echo "ğŸ“Š Files that should exist for deployment:"
        echo "index.html: $(test -f index.html && echo 'âœ… EXISTS' || echo 'âŒ MISSING')"
        echo "sw.js: $(test -f sw.js && echo 'âœ… EXISTS' || echo 'âŒ MISSING')"
        echo "manifest.json: $(test -f manifest.json && echo 'âœ… EXISTS' || echo 'âŒ MISSING')"
        echo "=============================================="
    
    - name: ğŸ” Debug Phase 3 - Pre-build environment check
      run: |
        echo "=============================================="
        echo "ğŸ” DEBUG: Pre-build environment"
        echo "=============================================="
        echo "ğŸŒ Environment variables:"
        echo "RIOT_API_KEY: $(test -n '${{ secrets.RIOT_API_KEY }}' && echo 'SET' || echo 'NOT SET')"
        echo "TARGET_REGION: ${{ env.TARGET_REGION }}"
        echo "ACCOUNT_REGION: ${{ env.ACCOUNT_REGION }}"
        echo "OUTPUT_DIR: ${{ env.OUTPUT_DIR }}"
        echo "CACHE_DIR: ${{ env.CACHE_DIR }}"
        echo "BUILD_TYPE: ${{ inputs.build_type }}"
        echo ""
        echo "ğŸ“¦ Node.js/npm info:"
        node --version
        npm --version
        echo ""
        echo "ğŸ“œ package.json scripts:"
        cat package.json | grep -A 10 '"scripts"' || echo "package.json not found"
        echo ""
        echo "ğŸ”€ Git status before build:"
        git status || echo "âŒ Git command failed before build"
        echo "=============================================="
    
    - name: Quick rebuild for deployment
      env:
        RIOT_API_KEY: ${{ secrets.RIOT_API_KEY }}
        TARGET_REGION: ${{ env.TARGET_REGION }}
        ACCOUNT_REGION: ${{ env.ACCOUNT_REGION }}
        OUTPUT_DIR: ${{ env.OUTPUT_DIR }}
        CACHE_DIR: ${{ env.CACHE_DIR }}
        DEBUG_MODE: false
      run: |
        echo "=============================================="
        echo "ğŸš€ Starting build process..."
        echo "=============================================="
        
        # ãƒ“ãƒ«ãƒ‰å‰ã®çŠ¶æ…‹ç¢ºèª
        echo "ğŸ“‚ Pre-build directory state:"
        ls -la
        echo ""
        
        # ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
        if [ "${{ inputs.build_type }}" == "dev" ]; then
          echo "ğŸ”¨ Executing: npm run build:dev"
          npm run build:dev || {
            echo "âŒ Build:dev failed with exit code $?"
            echo "ğŸ“‚ Directory state after failed build:"
            ls -la
            exit 1
          }
        else
          echo "ğŸ”¨ Executing: npm run build:prod"
          npm run build:prod || {
            echo "âŒ Build:prod failed with exit code $?"
            echo "ğŸ“‚ Directory state after failed build:"
            ls -la
            exit 1
          }
        fi
        
        echo "âœ… Build process completed"
        echo "=============================================="
    
    - name: ğŸ” Debug Phase 4 - Post-build state analysis
      run: |
        echo "=============================================="
        echo "ğŸ” DEBUG: Post-build state analysis"
        echo "=============================================="
        echo "ğŸ“‚ Directory contents after build:"
        ls -la
        echo ""
        echo "ğŸ“Š Critical files status:"
        echo "index.html: $(test -f index.html && echo 'âœ… EXISTS' || echo 'âŒ MISSING')"
        echo "sw.js: $(test -f sw.js && echo 'âœ… EXISTS' || echo 'âŒ MISSING')"
        echo "manifest.json: $(test -f manifest.json && echo 'âœ… EXISTS' || echo 'âŒ MISSING')"
        echo ""
        echo "ğŸ“ File sizes:"
        if [ -f index.html ]; then
          echo "index.html: $(wc -c < index.html) bytes"
        fi
        if [ -f sw.js ]; then
          echo "sw.js: $(wc -c < sw.js) bytes"
        fi
        if [ -f manifest.json ]; then
          echo "manifest.json: $(wc -c < manifest.json) bytes"
        fi
        echo ""
        echo "ğŸ”€ Git status after build:"
        git status || echo "âŒ Git command failed after build"
        echo ""
        echo "ğŸ“ .git directory check after build:"
        if [ -d ".git" ]; then
          echo "âœ… .git directory still exists"
        else
          echo "âŒ .git directory disappeared after build!"
        fi
        echo ""
        echo "ğŸ“‚ HTML files generated:"
        find . -maxdepth 1 -name "*.html" | head -5
        echo ""
        echo "ğŸ–¼ï¸ Images directory:"
        ls -la images/ 2>/dev/null | head -5 || echo "images/ directory not found"
        echo "=============================================="
    
    - name: ğŸ” Debug Phase 5 - Pre-deployment final check
      run: |
        echo "=============================================="
        echo "ğŸ” DEBUG: Pre-deployment final check"
        echo "=============================================="
        echo "ğŸŒ Current working directory:"
        pwd
        echo ""
        echo "ğŸ“‚ Final directory listing:"
        ls -la
        echo ""
        echo "ğŸ”€ Final Git status:"
        git status || echo "âŒ CRITICAL: Git command failed before deployment!"
        echo ""
        echo "ğŸ“ .git directory final check:"
        if [ -d ".git" ]; then
          echo "âœ… .git directory exists for deployment"
          echo "Git remote configuration:"
          git remote -v 2>/dev/null || echo "No remotes configured"
        else
          echo "âŒ CRITICAL: .git directory missing before deployment!"
          echo "This will cause the deployment to fail!"
        fi
        echo ""
        echo "ğŸ“Š Ready for deployment:"
        READY=true
        if [ ! -f "index.html" ]; then
          echo "âŒ index.html missing"
          READY=false
        fi
        if [ ! -d ".git" ]; then
          echo "âŒ .git directory missing"
          READY=false
        fi
        if [ "$READY" = true ]; then
          echo "âœ… All prerequisites met for deployment"
        else
          echo "âŒ Deployment prerequisites NOT met"
        fi
        echo "=============================================="
    
    - name: ğŸ” Debug Phase 6 - Deploy action diagnostics
      run: |
        echo "=============================================="
        echo "ğŸ” DEBUG: Deploy action diagnostics"
        echo "=============================================="
        echo "ğŸ“Š peaceiris/actions-gh-pages@v3 requirements check:"
        echo ""
        echo "1. GitHub token: $(test -n '${{ secrets.GITHUB_TOKEN }}' && echo 'âœ… SET' || echo 'âŒ NOT SET')"
        echo "2. Publish directory (.): $(test -d '.' && echo 'âœ… EXISTS' || echo 'âŒ MISSING')"
        echo "3. Git repository: $(test -d '.git' && echo 'âœ… EXISTS' || echo 'âŒ MISSING - THIS WILL FAIL')"
        echo "4. Required files in publish_dir:"
        echo "   - index.html: $(test -f './index.html' && echo 'âœ… EXISTS' || echo 'âŒ MISSING')"
        echo "   - Other HTML files: $(find . -maxdepth 1 -name '*.html' | wc -l) files"
        echo ""
        echo "ğŸš« Files to be excluded from deployment:"
        echo "node_modules/: $(test -d 'node_modules' && echo 'EXISTS (will exclude)' || echo 'NOT FOUND')"
        echo "src/: $(test -d 'src' && echo 'EXISTS (will exclude)' || echo 'NOT FOUND')"
        echo ".env*: $(ls .env* 2>/dev/null | wc -l) files (will exclude)"
        echo ".git*: $(ls .git* 2>/dev/null | wc -l) files (will exclude)"
        echo "*.md: $(ls *.md 2>/dev/null | wc -l) files (will exclude)"
        echo "package*.json: $(ls package*.json 2>/dev/null | wc -l) files (will exclude)"
        echo "data/: $(test -d 'data' && echo 'EXISTS (will exclude)' || echo 'NOT FOUND')"
        echo "templates/: $(test -d 'templates' && echo 'EXISTS (will exclude)' || echo 'NOT FOUND')"
        echo ".github/: $(test -d '.github' && echo 'EXISTS (will exclude)' || echo 'NOT FOUND')"
        echo ""
        echo "ğŸ“‚ Final files to be deployed:"
        # Simulate the exclusion logic
        find . -maxdepth 2 -type f \
          ! -path './node_modules/*' \
          ! -path './src/*' \
          ! -path './.env*' \
          ! -path './.git*' \
          ! -name '*.md' \
          ! -name 'package*.json' \
          ! -path './data/*' \
          ! -path './templates/*' \
          ! -path './.github/*' \
          | head -10
        echo "... (showing first 10 files)"
        echo "=============================================="
    
    - name: Setup Pages
      uses: actions/configure-pages@v3
    
    - name: Upload Pages artifact
      uses: actions/upload-pages-artifact@v2
      with:
        path: .
    
    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v2

  # Job 3: é€šçŸ¥ã¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹
  notify-completion:
    runs-on: ubuntu-latest
    needs: [build-counter-data, deploy-to-pages]
    if: always()
    
    steps:
    - name: ğŸ” Debug Phase 7 - Final workflow state
      run: |
        echo "=============================================="
        echo "ğŸ” DEBUG: Final workflow state summary"
        echo "=============================================="
        echo "ğŸ“Š Job Results Summary:"
        echo "build-counter-data: ${{ needs.build-counter-data.result }}"
        echo "deploy-to-pages: ${{ needs.deploy-to-pages.result }}"
        echo ""
        echo "ğŸ“ˆ Job Outputs (if available):"
        echo "pages-generated: ${{ needs.build-counter-data.outputs.pages-generated }}"
        echo "build-success: ${{ needs.build-counter-data.outputs.build-success }}"
        echo "data-quality: ${{ needs.build-counter-data.outputs.data-quality }}"
        echo ""
        echo "ğŸ” Deployment Analysis:"
        if [ "${{ needs.deploy-to-pages.result }}" == "failure" ]; then
          echo "âŒ DEPLOYMENT FAILED - This indicates the root cause was identified"
          echo "   Check the debug phases above to see where the problem occurred"
        elif [ "${{ needs.deploy-to-pages.result }}" == "success" ]; then
          echo "âœ… DEPLOYMENT SUCCEEDED - Issue was resolved by debug investigation"
        else
          echo "âš ï¸ DEPLOYMENT STATUS: ${{ needs.deploy-to-pages.result }}"
        fi
        echo "=============================================="
    
    - name: Build Status Notification
      run: |
        echo "ğŸ“¢ FastestLOL Auto-Update Status Report"
        echo "==========================================="
        
        if [ "${{ needs.build-counter-data.result }}" == "success" ] && [ "${{ needs.deploy-to-pages.result }}" == "success" ]; then
          echo "âœ… Status: SUCCESS - Site updated successfully!"
          echo "ğŸŒ Live URL: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}"
          echo ""
          echo "ğŸ“Š Build Metrics:"
          echo "  â€¢ Total Pages: ${{ needs.build-counter-data.outputs.pages-generated }}"
          echo "  â€¢ Listing Pages: ${{ needs.build-counter-data.outputs.listing-pages }}"
          echo "  â€¢ Detail Pages: ${{ needs.build-counter-data.outputs.detail-pages }}"
          echo "  â€¢ Data Quality: ${{ needs.build-counter-data.outputs.data-quality }}"
          echo "  â€¢ Index Size: ${{ needs.build-counter-data.outputs.index-size }} bytes"
          echo "  â€¢ Champion Images: ${{ needs.build-counter-data.outputs.champion-images }}"
          echo ""
          echo "ğŸ—ï¸ Architecture: True Static-First"
          echo "ğŸš€ Performance: Cache-First + Zero-JS + Zero-CSS"
          echo "âš¡ Estimated First Paint: <100ms"
          echo ""
          echo "ğŸ•°ï¸ Next Update: 6 hours"
          
        elif [ "${{ needs.build-counter-data.result }}" == "failure" ]; then
          echo "âŒ Status: BUILD FAILED"
          echo "  â€¢ Issue: Counter data generation failed"
          echo "  â€¢ Possible causes:"
          echo "    - API key expired or invalid"
          echo "    - Rate limit exceeded"
          echo "    - Network issues accessing Riot API"
          echo "    - Data processing errors"
          echo "  â€¢ Action: Review build logs above"
          
        elif [ "${{ needs.deploy-to-pages.result }}" == "failure" ]; then
          echo "âŒ Status: DEPLOYMENT FAILED"
          echo "  â€¢ Issue: GitHub Pages deployment failed"
          echo "  â€¢ Possible causes:"
          echo "    - Repository settings misconfigured"
          echo "    - GitHub Pages disabled"
          echo "    - Permission issues"
          echo "  â€¢ Action: Check repository settings > Pages"
          
        elif [ "${{ needs.deploy-to-pages.result }}" == "skipped" ]; then
          echo "âš ï¸ Status: BUILD SUCCESS, DEPLOYMENT SKIPPED"
          echo "  â€¢ Reason: Build failed quality checks"
          echo "  â€¢ Build Quality: ${{ needs.build-counter-data.outputs.data-quality }}"
          echo "  â€¢ Action: Check build validation logs"
          
        else
          echo "âš ï¸ Status: PARTIAL SUCCESS"
          echo "  â€¢ Build: ${{ needs.build-counter-data.result }}"
          echo "  â€¢ Deploy: ${{ needs.deploy-to-pages.result }}"
          echo "  â€¢ Action: Check individual job logs"
        fi
        
        echo "==========================================="
    
    - name: Performance Audit Report
      if: needs.build-counter-data.result == 'success'
      run: |
        echo "ğŸš€ True Static-First Performance Audit"
        echo "========================================"
        
        # ã‚µã‚¤ã‚ºè©•ä¾¡
        INDEX_SIZE="${{ needs.build-counter-data.outputs.index-size }}"
        if [ "$INDEX_SIZE" -lt 200000 ]; then
          SIZE_RATING="ğŸŸ¢ Excellent"
        elif [ "$INDEX_SIZE" -lt 300000 ]; then
          SIZE_RATING="ğŸŸ¡ Good"
        else
          SIZE_RATING="ğŸ”´ Needs Optimization"
        fi
        
        # ãƒ‡ãƒ¼ã‚¿å“è³ªè©•ä¾¡
        QUALITY="${{ needs.build-counter-data.outputs.data-quality }}"
        case $QUALITY in
          "high")   QUALITY_ICON="ğŸŸ¢ High Quality" ;;
          "medium") QUALITY_ICON="ğŸŸ¡ Medium Quality" ;;
          "low")    QUALITY_ICON="ğŸ”´ Low Quality" ;;
          *)        QUALITY_ICON="â“ Unknown" ;;
        esac
        
        echo "ğŸ“„ Pages: ${{ needs.build-counter-data.outputs.pages-generated }} total"
        echo "ğŸ’¾ Index Size: ${INDEX_SIZE} bytes ($SIZE_RATING)"
        echo "ğŸ–¼ï¸ Images: ${{ needs.build-counter-data.outputs.champion-images }} champion portraits"
        echo "ğŸ“Š Data Quality: $QUALITY_ICON"
        echo "âš™ï¸ Service Worker: Complete offline support"
        echo "ğŸš€ Estimated Metrics:"
        echo "   â€¢ First Paint: <100ms"
        echo "   â€¢ LCP: <200ms"
        echo "   â€¢ CLS: ~0.02"
        echo "   â€¢ TTI: <150ms"
        echo "ğŸ’¾ Zero JS/CSS: Pure HTML tables only"
        echo "ğŸŒ CDN Ready: Full static deployment"
        echo "========================================"
        
    - name: Update README Badge
      if: needs.build-counter-data.result == 'success' && needs.deploy-to-pages.result == 'success'
      run: |
        echo "ğŸ·ï¸ Updating status badges..."
        echo "Build Status: âœ… SUCCESS"
        echo "Last Updated: $(date -u +"%Y-%m-%d %H:%M UTC")"
        echo "Pages Generated: ${{ needs.build-counter-data.outputs.pages-generated }}"
        echo "Data Quality: ${{ needs.build-counter-data.outputs.data-quality }}"